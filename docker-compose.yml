services:
  provisioner:
    build: .
    volumes:
      - .:/${COMPOSE_PROJECT_NAME:?}:ro
      # The output directory is mounted as rw so that the provisioner can write
      # to it.
      - ./outputs:/${COMPOSE_PROJECT_NAME:?}/outputs:rw
    tmpfs:
      - /run:exec
      - /tmp:exec
    working_dir: /${COMPOSE_PROJECT_NAME:?}
    # init handles singal forwarding so the container can be stopped gracefully.
    init: true
    environment:
      DRY_RUN: ${DRY_RUN:-}
      PYTHONPATH: /${COMPOSE_PROJECT_NAME:?}
